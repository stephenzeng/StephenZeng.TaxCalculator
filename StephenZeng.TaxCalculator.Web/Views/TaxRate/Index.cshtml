@model IEnumerable<StephenZeng.TaxCalculator.Domain.Models.TaxRate>

@{
    ViewBag.Title = "Tax Rates";
}

<div class="clearfix">
    @Html.ActionLink("Add Tax Rates", "Add", "TaxRate", null, new { @class = "btn btn-default pull-right" })
</div>

<div class="panel panel-default margin-top-5">
    <div class="panel-heading">
        <span class="fa fa-tags"></span> 
        @ViewBag.Title
    </div>
    <div class="panel-body">
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Year</th>
                    <th>Description</th>
                    <th></th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                @if (Model != null)
                {
                    foreach (var taxRate in Model)
                    {
                        <tr>
                            <td>@taxRate.Year</td>
                            <td>@taxRate.Description</td>
                            <td>
                                <a href="#" onclick=" copyConfig('@Url.Action("Copy", "TaxRate", new {taxRate.Id}, null)'); " title="Copy this tax rate">
                                    <span class="fa fa-copy"></span> Copy
                                </a>
                            </td>
                            <td>
                                <a href="@Url.Action("Edit", "TaxRate", new {taxRate.Id}, null)" title="Edit">
                                    <span class="fa fa-edit"></span> Edit
                                </a>
                            </td>
                        </tr>
                    }
                }
            </tbody>
        </table>
    </div>
</div>

@section scripts
{
    <script type="text/javascript">
        var copyConfig = function(url) {
            console.log(url);
            $.ajax({
                url: url,
                success: function (id) {
                    console.log(id);
                    $(location).attr('href', '@Url.Action("Edit", "TaxRate")/'+id);
                },
                error: function(event, xhr, settings) {
                    displayAlert(xhr.status + ' ' + xhr.statusText);
                }
            });
        }

        var displayAlert = function(msg) {
            $('#alertDiv').show();
            $('#alertText').text(msg);
        }
    </script>
}
